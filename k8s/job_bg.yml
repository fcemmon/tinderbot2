apiVersion: batch/v1
kind: Job
metadata:
  name: swipejob-bg
spec:
  ttlSecondsAfterFinished: 100
  template:
    metadata:
      labels:
        app: swipejob
    spec:
      automountServiceAccountToken: false
      restartPolicy: OnFailure
      containers:
      - name: docker-vnc-xfce4
        # args: ["$JOBID"]
        image: registry.localhost:5000/docker-vnc-xfce4:latest
        securityContext:
          allowPrivilegeEscalation: true
        tty: true
        ports:
          - containerPort: 6080
            name: novnc
        volumeMounts:
        - mountPath: /home/user/tbot
          name: code
        - mountPath: /entrypoint.sh
          name: entrypoint
        - mountPath: /dev/shm
          name: dshm
        - name: log-volume
          mountPath: /var/log
        - name: screenshots
          mountPath: /var/screenshots
        - name: videos
          mountPath: /var/videos
        env:
          - name: LANG
            value: en_EN.UTF-8
          - name: DESKTOP_ENV
            value: xfce4
          - name: DESKTOP_SIZE
            value: "1920x1080"
      volumes:
      - name: log-volume
        hostPath:
          path: /home/bijan/tinderbot2/logs
      - name: videos
        hostPath:
          path: /home/bijan/tinderbot2/videos
      - name: screenshots
        hostPath:
          path: /home/bijan/tinderbot2/screenshots
      - name: code
        hostPath:
          path: /home/bijan/tinderbot2
      - name: entrypoint
        hostPath:
          path: /home/bijan/tinderbot2/entrypoint.sh
      - name: dshm
        emptyDir:
          medium: Memory
---
apiVersion: v1
kind: Service
metadata:
  name: bot-bg
spec:
  type: NodePort
  selector:
    app: swipejob-bg
  ports:
    - name:
      protocol: TCP
      port: 6080
      targetPort: 6080
      nodePort: 30001
  externalIPs:
    - 100.121.94.78
